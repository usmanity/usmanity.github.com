<html>
<head>
<title>2ndGraph</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js" type="text/javascript"></script>

<style>
  #user-stats{
    background-color: rgba(255, 255, 255, 1);
  }
  .yellow {
    background-color: rgba(255, 255, 0, 0.5) !important;
    -webkit-transition: all 1s ease-in-out;
  }
  .fade-yellow {
    background-color: rgba(255, 255, 255, 0.5) !important;
    -webkit-transition: all 1s ease-in-out;
  }
  .text-input {
    height: 50px;
    width: 200px;
    font-size: 30px;
  }
  .hide {
    display: none;
  }
</style>

  </head>
  <body>
    <div id="userInfo">
      <form id="js-user" name="user-info" class="hide">
        <input name="username" placeholder="Username" id="username" class="text-input"/>
        <a type="submit" id="get-stats" class="button" href="#">Go</a>
      </form>
    </div>
    <div id="user-stats">
      <div class="plays hide" id="playcount">
      </div>
    </div>
    
<script>
  $.ajaxSetup({
    cache: false
  });

(function($){

  var GetUsername = Backbone.View.extend({

    el: $("#userInfo"),

    events: {
      'click .button' : 'getStats',
      'submit' : 'getStats'
    },

    initialize: function() {
      _.bindAll(this, 'render');
      this.render();
    },

    render: function(){
      $("#js-user").removeClass("hide");
    },

    getStats: function(){
      // validate and process form here...
      var username = $("#username").val();
      var dataString = 'user='+username;
      $.ajax({
        type: "GET",
        url: "http://ws.audioscrobbler.com/2.0/?format=json&method=user.getinfo&api_key=b25b959554ed76058ac220b7b2e0a026&",
        data: dataString,
        success: function(data) {
          $("#user-stats").text(data.user.playcount).fadeIn();
          console.log(data)
        }
      });
      var refreshId = setInterval(function() {
        $.ajax({
          type: "GET",
          url: "http://ws.audioscrobbler.com/2.0/?format=json&method=user.getinfo&api_key=b25b959554ed76058ac220b7b2e0a026&",
          data: dataString,
          success: function(data) {
            var updatedCount = data.user.playcount;
            var currentCount = $("#user-stats").text();
            console.log("Current count: " + currentCount);
            console.log("Updated count: " + updatedCount);

            if (data.user.playcount != $("#user-stats").text() ) {
              $("#user-stats").text(data.user.playcount).fadeIn();
              $("#user-stats").addClass("yellow");
              $("#user-stats").removeClass("fade-yellow");
              setTimeout(function() {
                $("#user-stats").addClass("fade-yellow");
                $("#user-stats").removeClass("yellow");
              }, 1000);
            }
            console.log(data)
          }
        });
      }, 5000);
      return false;
    }

  });

  var putUserInput = new GetUsername();
})(jQuery);

</script>
</body>
</html>
